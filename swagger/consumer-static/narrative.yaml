# This is an OpenAPI Specification (https://swagger.io/specification/)
# for the National Record Locator Consumer FHIR API
# owned by NHS Digital (https://digital.nhs.uk/)
info:
  version: 1.0.0
  title: National Record Locator Consumer - FHIR API
  contact:
    name: NHS Digital API Management
    url: "https://digital.nhs.uk/developer/help-and-support"
    email: api.management@nhs.net
  description: |
    ## Overview
    The National Record Locator (NRL) is a service that holds pointers to data held in local provider systems.

    The service facilitates national sharing, removing the need for organisations to create duplicate copies of information across systems and organisations, by enabling access to up-to-date information directly from the source.

    It can be used to store and publish pointers to patient data held in health systems across England and to look up where relevant patient data is held.

    As a "consumer" of pointers relating to citizens, you can:

    -Search a pointer, where you are authorised to do so, for a given patient
    -Read a pointer, where you are authorised to do so, for a given patient

    This service is a new version of the NRL moving to R4 from STU3, more information on the existing STU3 NRL service can be found on the following page, [National Record Locator (NRL)](https://digital.nhs.uk/services/national-record-locator).

    There is a growing list of health and social care organisations authorised to share records using NRL.

    ### Data availability, timing and quality
    Pointers are available to be consumed almost immediately after they have been produced by the provider.

    ## Who can use this API
    This API:
    - is only for use by patient-facing applications
    - is only for non-clinical use
    - can only be used where there is a legal basis to do so

    You can not currently use this API to retrieve pointers for:
    - mental health crisis plans
    - end of life plans
    - emergency care plans (eRedbags)
    - national early warning scores (NEWS)
    - urgent care plan

    Make sure you have a valid use case before you go too far with your development.
    To do this, [contact us](https://digital.nhs.uk/developer/help-and-support).

    You must do this before you can go live (see ‘Onboarding’ below).

    ## API status and roadmap
    This API is [in development](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#statuses).

    To see our roadmap, or to suggest, comment or vote on features for this API, see our [interactive product backlog](https://nhs-digital-api-management.featureupvote.com/?tag=national-record-locator-api).

    If you have any other queries, [contact us](https://digital.nhs.uk/developer/help-and-support).

    ## Service level

    This API is a bronze service, meaning it is operational and supported only during business hours (8am to 6pm), Monday to Friday, excluding bank holidays.

    For more details, see [service levels](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#service-levels).

    ## Technology
    This API is [RESTful](https://digital.nhs.uk/developer/guides-and-documentation/our-api-technologies#basic-rest).

    It conforms to the [FHIR](https://digital.nhs.uk/developer/guides-and-documentation/our-api-technologies#fhir) global standard for health care data exchange, specifically to [FHIR R4 (v4.0.1)](https://hl7.org/fhir/r4/), except that it does not support the [capabilities](http://hl7.org/fhir/R4/http.html#capabilities) interaction.

    It includes some country-specific FHIR extensions, which conform to [FHIR UK Core](https://digital.nhs.uk/services/fhir-uk-core), specifically [fhir.r4.ukcore.stu1 0.5.1](https://simplifier.net/packages/fhir.r4.ukcore.stu1/0.5.1).

    You do not need to know much about FHIR to use this API - FHIR APIs are just RESTful APIs that follow specific rules.
    In particular:
    - resource names are capitalised and singular, and use US spellings, for example `/Immunization` not `/immunisations`
    - array names are singular, for example `entry` not `entries` for address lines
    - data items that are country-specific and thus not included in the FHIR global base resources are usually wrapped in an `extension` object

    There are [libraries and SDKs available](https://digital.nhs.uk/developer/guides-and-documentation/api-technologies-at-nhs-digital#fhir-libraries-and-sdks) to help with FHIR API integration.

    ## Network access
    This API is available on the internet and, indirectly, on the [Health and Social Care Network (HSCN)](https://digital.nhs.uk/services/health-and-social-care-network).

    For more details see [Network access for APIs](https://digital.nhs.uk/developer/guides-and-documentation/network-access-for-apis).

    ## Security and authorisation

    This API uses the following access modes:
    * application-restricted access

    ### Application-restricted access

    This access mode is [application-restricted](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation#application-restricted-apis), meaning we authenticate the calling application but not the end user.

    To use this access mode, use the following security pattern:
    * [Application-restricted RESTful API - signed JWT authentication](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation/application-restricted-restful-apis-signed-jwt-authentication)

    ## Environments and testing
    | Environment       | Base URL                                                               |
    | ----------------- | ---------------------------------------------------------------------- |
    | Sandbox           | `https://sandbox.api.service.nhs.uk/nrl-consumer-api/FHIR/R4/`     |
    | Integration test  | `https://int.api.service.nhs.uk/nrl-consumer-api/FHIR/R4/`         |
    | Production        | `https://api.service.nhs.uk/nrl-consumer-api/FHIR/R4/`             |

    ### Sandbox testing
    Our [sandbox environment](https://digital.nhs.uk/developer/guides-and-documentation/testing#sandbox-testing):
    * is for early developer testing
    * only covers a limited set of scenarios
    * is open access, so does not allow you to test authorisation

    For details of sandbox test scenarios, or to try out the sandbox using our 'Try this API' feature, see the documentation for each endpoint.

    Alternatively, you can try out the sandbox using our Postman collection:

    [![Run in Postman](https://run.pstmn.io/button.svg)](https://app.getpostman.com/run-collection/TBC)

    ### Integration testing
    Our [integration test environment](https://digital.nhs.uk/developer/guides-and-documentation/testing#integration-testing):
    * is for formal integration testing
    * includes authorisation

    It also includes ready-to-use TBC test data

    For more details see [integration testing with our RESTful APIs](https://digital.nhs.uk/developer/guides-and-documentation/testing#integration-testing-with-our-restful-apis).

    ## Onboarding
    You need to get your software approved by us before it can go live with this API. We call this onboarding. The onboarding process can sometimes be quite long, so it’s worth planning well ahead.

    This API uses our online digital onboarding process.

    As part of this process, you need to demonstrate that you can manage risks and that your software conforms technically with the requirements for this API.

    Information on this page might impact the design of your software. For details, see [Onboarding support information](https://digital.nhs.uk/developer/api-catalogue/national-record-locator-consumer-api/onboarding-support-information).

    To get started, see [digital onboarding](https://digital.nhs.uk/developer/guides-and-documentation/digital-onboarding#using-the-digital-onboarding-portal).
paths:
  /DocumentReference:
    get:
      summary: Search (GET)
      description: |
        Perform a Search using GET query string parameters
      responses:
        "200":
          description: Search successful response
          content:
            application/fhir+json:
              example:
                resourceType: Bundle
                type: searchset
                total: 1
                entry:
                  - resource:
                      resourceType: DocumentReference
                      id: Y05868-1634567890
                      meta:
                        profile:
                          - http://fhir.nhs.net/StructureDefinition/nrls-documentreference-1-0
                      masterIdentifier:
                        system: urn:ietf:rfc:3986
                        value: urn:oid:1.3.6.1.4.1.21367.2005.3.7
                      identifier:
                        - system: urn:ietf:rfc:3986
                          value: urn:oid:1.3.6.1.4.1.21367.2005.3.7.1234
                      status: current
                      docStatus: preliminary
                      type:
                        coding:
                          - system: http://snomed.info/sct
                            code: "736253002"
                            display: Mental health crisis plan
                      category:
                        - coding:
                            - system: http://loinc.org
                              code: 34108-1
                              display: Outpatient Note
                      subject:
                        identifier:
                          system: https://fhir.nhs.uk/Id/nhs-number
                          value: "4409815415"
                      date: "2022-12-20T09:45:41+11:00"
                      author:
                        - identifier:
                            value: Practitioner/A985657ZA
                      authenticator:
                        identifier:
                          value: Organization/Y05868
                      custodian:
                        identifier:
                          system: https://fhir.nhs.uk/Id/ods-organization-code
                          value: Y05868
                      description: Physical
                      securityLabel:
                        - coding:
                            - system: http://terminology.hl7.org/CodeSystem/v3-Confidentiality
                              code: V
                              display: very restricted
                      content:
                        - attachment:
                            contentType: application/pdf
                            language: en-US
                            url: https://spine-proxy.national.ncrs.nhs.uk/p1.nhs.uk/EPAACS/MentalHealthCrisisPlan.pdf
                            hash: 2jmj7l5rSw0yVb/vlWAYkK/YBwk=
                            title: Physical
                            creation: "2022-12-20T09:45:41+11:00"
                          format:
                            system: urn:oid:1.3.6.1.4.1.19376.1.2.3
                            code: urn:ihe:pcc:handp:2008
                            display: History and Physical Specification
                      context:
                        encounter:
                          - identifier:
                              value: Encounter/4409815415
                        event:
                          - coding:
                              - system: http://snomed.info/sct
                                code: "305625009"
                                display: Seen by mental health counselor
                        period:
                          start: "2022-12-20T09:00:41+11:00"
                          end: "2022-12-20T09:45:41+11:00"
                        facilityType:
                          coding:
                            - system: http://snomed.info/sct
                              code: "390826005"
                              display: Mental health caregiver support
                        practiceSetting:
                          coding:
                            - system: http://snomed.info/sct
                              code: "390826005"
                              display: Mental health caregiver support
                        sourcePatientInfo:
                          identifier:
                            value: Patient/4409815415
                        related:
                          - identifier:
                              system: https://fhir.nhs.uk/Id/ods-organization-code
                              value: MENTAL HEALTH OUTREACH

  /DocumentReference/_search:
    post:
      summary: Search (POST)
      description: |
        Same as above but a POST to avoid URL length limits
      responses:
        "200":
          description: Search successful response
          content:
            application/fhir+json:
              example:
                resourceType: Bundle
                type: searchset
                total: 1
                entry:
                  - resource:
                      resourceType: DocumentReference
                      id: Y05868-1234567895
                      meta:
                        profile:
                          - http://fhir.nhs.net/StructureDefinition/nrls-documentreference-1-0
                      masterIdentifier:
                        system: urn:ietf:rfc:3986
                        value: urn:oid:1.3.6.1.4.1.21367.2005.3.9
                      identifier:
                        - system: urn:ietf:rfc:3986
                          value: urn:oid:1.3.6.1.4.1.21367.2005.3.7.1239
                      status: current
                      docStatus: final
                      type:
                        coding:
                          - system: http://snomed.info/sct
                            code: "736253002"
                            display: Mental Health Crisis Plan
                      category:
                        - coding:
                            - system: http://loinc.org
                              code: 55112-7
                              display: Document summary
                      subject:
                        identifier:
                          system: https://fhir.nhs.uk/Id/nhs-number
                          value: "4409815415"
                      date: "2022-12-21T10:45:41+11:00"
                      author:
                        - identifier:
                            value: Practitioner/A985657ZA
                      authenticator:
                        identifier:
                          value: Organization/Y05868
                      custodian:
                        identifier:
                          system: https://fhir.nhs.uk/Id/ods-organization-code
                          value: Y05868
                      description: Physical
                      securityLabel:
                        - coding:
                            - system: http://terminology.hl7.org/CodeSystem/v3-Confidentiality
                              code: V
                              display: very restricted
                      content:
                        - attachment:
                            contentType: application/pdf
                            language: en-US
                            url: https://spine-proxy.national.ncrs.nhs.uk/p1.nhs.uk/EPAACS/EOLSummaryReport.pdf
                            size: 4000
                            hash: 2jmj7l5rSw0yVb/vlWAYkK/YBwk=
                            title: Physical
                            creation: "2021-12-21T10:45:41+11:00"
                          format:
                            system: urn:oid:1.3.6.1.4.1.19376.1.2.3
                            code: urn:ihe:pcc:cm:2008
                            display: Care Management
                      context:
                        encounter:
                          - identifier:
                              value: Encounter/4409815415
                        event:
                          - coding:
                              - system: http://snomed.info/sct
                                code: "861421000000109"
                                display: End of life care coordination summary
                        period:
                          start: "2022-12-21T09:00:41+11:00"
                          end: "2022-12-21T10:45:41+11:00"
                        facilityType:
                          coding:
                            - system: http://snomed.info/sct
                              code: "14866005"
                              display: Hospital outpatient mental health center
                        sourcePatientInfo:
                          identifier:
                            value: Patient/4409815415
                        related:
                          - identifier:
                              system: https://fhir.nhs.uk/Id/ods-organization-code
                              value: TRAFFORD GENERAL HOSPITAL

  /DocumentReference/{id}:
    get:
      summary: Read
      description: |
        Read a single DocumentReference record
      responses:
        "200":
          description: Search successful response
          content:
            application/fhir+json:
              example:
                resourceType: DocumentReference
                id: Y05868-1234567892
                status: current
                docStatus: final
                type:
                  coding:
                    - system: http://snomed.info/sct
                      code: "887701000000100"
                      display: Emergency health care plan
                category:
                  - coding:
                      - system: http://loinc.org
                        code: 68552-9
                        display: Emergency medicine Emergency department Admission evaluation note
                subject:
                  identifier:
                    system: https://fhir.nhs.uk/Id/nhs-number
                    value: "4409815415"
                date: "2022-12-22T11:45:41+11:00"
                author:
                  - identifier:
                      value: Practitioner/A985657ZA
                authenticator:
                  identifier:
                    value: Organization/Y05868
                custodian:
                  identifier:
                    system: https://fhir.nhs.uk/Id/ods-organization-code
                    value: Y05868
                securityLabel:
                  - coding:
                      - system: http://terminology.hl7.org/CodeSystem/v3-Confidentiality
                        code: V
                        display: very restricted
                content:
                  - attachment:
                      contentType: application/pdf
                      language: en-US
                      url: https://spine-proxy.national.ncrs.nhs.uk/p1.nhs.uk/EPAACS/EmergencyHealthPlan.pdf
                      creation: "2022-12-22T09:45:41+11:00"
                    format:
                      system: urn:oid:1.3.6.1.4.1.19376.1.2.3
                      code: urn:ihe:pcc:handp:2008
                      display: History and Physical Specification
                context:
                  encounter:
                    - identifier:
                        value: Encounter/4409815415
                  event:
                    - coding:
                        - system: http://snomed.info/sct
                          code: "702779007"
                          display: Emergency health care plan agreed
                  period:
                    start: "2022-12-20T09:00:41+11:00"
                    end: "2022-12-20T09:45:41+11:00"
                  facilityType:
                    coding:
                      - system: http://snomed.info/sct
                        code: "453121000124107"
                        display: Emergency department healthcare professional
                  related:
                    - identifier:
                        system: https://fhir.nhs.uk/Id/ods-organization-code
                        value: EMERGENCY DEPT PRIMARY CARE STREAMING

components:
  schemas:
    RequestQuerySubject:
      example: "https://fhir.nhs.uk/Id/nhs-number|4409815415"
    RequestQueryCustodian:
      example: "https://fhir.nhs.uk/Id/ods-organization-code|Y05868"
    RequestQueryType:
      example: "http://snomed.info/sct|736253002"

  parameters:
    id:
      examples:
        valid:
          summary: Valid
          value: Y05868-1234567892
        invalid:
          summary: Unknown
          value: Y05861-1234567800
    odsCode:
      examples:
        valid:
          summary: Valid
          value: https://fhir.nhs.uk/Id/ods-organization-code|Y05868
        invalid:
          summary: Unknown
          value: https://fhir.nhs.uk/Id/ods-organization-code|XYZ
    subject:
      examples:
        valid_1:
          summary: "Valid #1"
          value: https://fhir.nhs.uk/Id/nhs-number|4409815415
        valid_2:
          summary: "Valid #2"
          value: https://fhir.nhs.uk/Id/nhs-number|3495456481
        invalid:
          summary: Unknown
          value: https://fhir.nhs.uk/Id/nhs-number|3495456001
    custodian:
      examples:
        valid:
          summary: Valid
          value: https://fhir.nhs.uk/Id/ods-organization-code|Y05868
        invalid:
          summary: Unknown
          value: https://fhir.nhs.uk/Id/ods-organization-code|XYZ
    type:
      examples:
        SNOMED_CODES_MENTAL_HEALTH_CRISIS_PLAN:
          summary: Mental Health Crisis Plan
          value: http://snomed.info/sct|736253002
        SNOMED_CODES_EMERGENCY_HEALTH_CARE_PLAN:
          summary: Emergency Healthcare Plan
          value: http://snomed.info/sct|887701000000100
        SNOMED_CODES_END_OF_LIFE_CARE_COORDINATION_SUMMARY:
          summary: End of Life Care Coordination Summary
          value: http://snomed.info/sct|861421000000109
        SNOMED_CODES_NATIONAL_EARLY_WARNING_SCORE_2:
          summary: National Early Warning Code 2
          value: http://snomed.info/sct|1363501000000100
        invalid:
          summary: Unknown
          value: http://snomed.info/sct|410970009
