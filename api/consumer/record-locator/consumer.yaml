openapi: 3.0.0
# This is an OpenAPI Specification (https://swagger.io/specification/)
# for the National Record Locator Consumer FHIR API
# owned by NHS Digital (https://digital.nhs.uk/)
info:
  title: National Record Locator Consumer - FHIR API
  description: |
    ## Overview

    The National Record Locator (NRL) enables organisations to share patient data nationwide.  Rather than storing the
    data itself, it is used to share pointers to the data, held in provider systems.  It acts as an index and not a data
    repository.  Each document pointer is defined using the
    [FHIR R4 DocumentReference](http://hl7.org/fhir/documentreference.html) standard.

    ![National Record Locator](https://raw.githubusercontent.com/NHSDigital/nrl-consumer-api/master/specification/nrl.png)

    Users of the service fall into the categories of:

    * producers - capable of creating and managing pointers
    * consumers - capable of searching and reading pointers

    The service removes the need for organisations to create duplicate copies of information across systems and
    organisations, by enabling access to up-to-date information directly from the source.

    It can be used to store and publish pointers to patient data held in health systems across England and to look up
    where relevant patient data is held.

    There is a growing list of health and social care organisations authorised to share records using NRL, and presently
    the pointers are classified into the following types:

    * [Mental Health Crisis Plan](http://snomed.info/sct/736253002)
    * [Emergency Healthcare Plan](http://snomed.info/sct/887701000000100)
    * [End of Life Care Coordination Summary](http://snomed.info/sct|861421000000109)
    * [National Early Warning Code 2](http://snomed.info/sct|1363501000000100)

    You can also retrieve booking and referal pointers however you can not currently do this by directly integrating with
    the National Record Locator, you must instead onboard to the [Booking and Referral - FHIR API](https://digital.nhs.uk/developer/api-catalogue/booking-and-referral-fhir)

    ### As a Consumer

    Consumers can use this API to:

    * search for pointers, restricted to a single Patient at a time
    * read a specific pointer
    * operations are restricted to document types agreed during the [onboarding](#api-description__onboarding) process

    ### What has changed?

    This service is a replacement for the existing
    [National Record Locator (NRL)](https://digital.nhs.uk/services/national-record-locator), and has the following
    changes:

    * upgraded from FHIR STU3 to R4.
    * improved performance and scalability.
    * improved onboarding experience.
    * authenticated using [signed JWT](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation/application-restricted-restful-apis-signed-jwt-authentication) rather than mTLS.
    * greater flexibility, by wider support of the [FHIR R4 DocumentReference](http://hl7.org/fhir/documentreference.html) resource.

    ### Data availability, timing and quality

    Pointers are available to be consumed almost immediately after they have been produced by the provider.

    ## Who can use this API

    This API can only be used where there is a legal basis to do so. Make sure you have a valid use case before you go
    too far with your development. You must demonstrate you have a valid use case as part of digital onboarding.

    You must have the capability to verify NHS numbers by one of the following mechanisms:

      * full PDS Spine compliant system
      * Spine Mini Service PDS (SMSP)

    Connecting parties must have an appointed Clinical Safety Officer and undertake a Clinical Safety Assessment.

    You can not use this API to retrieve documents, however you should be prepared to retrieve in PDF or Unstructured
    formats.

    In order to retrieve a document, consumers must be able to interact with the National Record Locator and the Spine
    Secure Proxy (SSP).

    You can only use this API if your consuming application is only accessible using a valid NHS Smartcard for all users
    or a system that uses an authentication method supported by
    [NHS Care NHS Care Identity Service 2 (NHS CIS2)](https://digital.nhs.uk/services/identity-and-access-management/nhs-care-identity-service-2).

    You must do this before you can go live (see ‘[Onboarding](#api-description__onboarding)’ below).

    ## API status and roadmap

    This API is [in development](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#statuses).

    To see our roadmap, or to suggest, comment or vote on features for this API, see our
    [interactive product backlog](https://nhs-digital-api-management.featureupvote.com/?tag=national-record-locator-api).

    If you have any other queries, [contact us](https://digital.nhs.uk/developer/help-and-support).

    ## Service level

    This API is a bronze service, meaning it is operational and supported only during business hours (8am to 6pm),
    Monday to Friday, excluding bank holidays.

    For more details, see [service levels](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#service-levels).

    ## Technology

    This API is [RESTful](https://digital.nhs.uk/developer/guides-and-documentation/our-api-technologies#basic-rest).

    It conforms to the [FHIR](https://digital.nhs.uk/developer/guides-and-documentation/our-api-technologies#fhir)
    global standard for health care data exchange, specifically to [FHIR R4 (v4.0.1)](https://hl7.org/fhir/r4/), except
    that it does not support the [capabilities](http://hl7.org/fhir/R4/http.html#capabilities) interaction.

    It includes some country-specific FHIR extensions, which conform to
    [FHIR UK Core](https://digital.nhs.uk/services/fhir-uk-core), specifically
    [fhir.r4.ukcore.stu1 0.5.1](https://simplifier.net/packages/fhir.r4.ukcore.stu1/0.5.1).

    You do not need to know much about FHIR to use this API - FHIR APIs are just RESTful APIs that follow specific rules.

    In particular:

    * resource names are capitalised and singular, and use US spellings, for example `Organization` not `organisations`
    * array names are singular, for example `entry` not `entries` for address lines
    * data items that are country-specific and thus not included in the FHIR global base resources are usually wrapped in an `extension` object

    There are [libraries and SDKs available](https://digital.nhs.uk/developer/guides-and-documentation/api-technologies-at-nhs-digital#fhir-libraries-and-sdks) to help with FHIR API integration.

    ## Network access

    This API is available on the internet and, indirectly, on the [Health and Social Care Network (HSCN)](https://digital.nhs.uk/services/health-and-social-care-network).

    For more details see [Network access for APIs](https://digital.nhs.uk/developer/guides-and-documentation/network-access-for-apis).

    ## Security and authorisation

    This API uses the following access modes:

    * [Application-restricted RESTful API - signed JWT authentication](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation/application-restricted-restful-apis-signed-jwt-authentication)

    ## Errors

    We use standard HTTP status codes to show whether an API request succeeded or not. They are usually in the range:

    * 200 to 299 if it succeeded, including code 202 if it was accepted by an API that needs to wait for further action
    * 400 to 499 if it failed because of a client error by your application
    * 500 to 599 if it failed because of an error on our server

    Errors specific to each API are shown in the Endpoints section, under Response. See our [reference guide](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#http-status-codes) for more on errors.

    ## Open source

    You might find the following open source resources useful:

    | Resource                  | Description                                               | Links                                                                      |
    |---------------------------|-----------------------------------------------------------|----------------------------------------------------------------------------|
    | NRL v3 API                | Source code for the core API and sandbox                  | [GitHub repo](https://github.com/NHSDigital/nrlf)                          |
    | NRL v3 Producer API       | Source code for the producer API proxy and specification. | [GitHub repo](https://github.com/NHSDigital/nrl-producer-api)              |
    | NRL v3 Consumer API       | Source code for the consumer API proxy and specification. | [GitHub repo](https://github.com/NHSDigital/nrl-consumer-api)              |
    | Lambda Pipeline Package   | Source code for the lambda pipeline utility               | [GitHub repo](https://github.com/NHSDigital/nrlf-lambda-pipeline)          |
    | Lambda Logging Package    | Source code for the lambda logging utility                | [GitHub repo](https://github.com/NHSDigital/nrlf-lambda-logging)           |

    We currently don't have any open source client libraries or sample code for this API. If you think this would be useful, you can [upvote the suggestion on our Interactive Product Backlog](https://nhs-digital-api-management.featureupvote.com/suggestions/107439/client-libraries-and-reference-implementations).

    The source code for the PDS FHIR back end (the Core Spine source code) is not currently in the open. If you think this would be useful, you can [upvote the suggestion on our Interactive Product Backlog](https://nhs-digital-api-management.featureupvote.com/suggestions/466692/open-source-core-spine-including-pds-eps-scr-and-more).

    ## Environments and testing

    | Environment       | Base URL                                                               |
    | ----------------- | ---------------------------------------------------------------------- |
    | Sandbox           | `https://sandbox.api.service.nhs.uk/record-locator/consumer/FHIR/R4/`  |
    | Integration test  | `https://int.api.service.nhs.uk/record-locator/consumer/FHIR/R4/`      |
    | Production        | `https://api.service.nhs.uk/record-locator/consumer/FHIR/R4/`          |

    ### Sandbox testing

    Our [sandbox environment](https://digital.nhs.uk/developer/guides-and-documentation/testing#sandbox-testing):
    * is for early developer testing
    * only covers a limited set of scenarios
    * is open access, so does not allow you to test authorisation

    For details of sandbox test scenarios, or to try out the sandbox using our 'Try this API' feature, see the
    documentation for each endpoint.

    Alternatively, you can try out the sandbox using our Postman collection:

    [![Run in Postman](https://run.pstmn.io/button.svg)](https://app.getpostman.com/run-collection/TBC)

    ### Integration testing

    Our [integration test environment](https://digital.nhs.uk/developer/guides-and-documentation/testing#integration-testing):

    * is for formal integration testing
    * includes authorisation

    It also includes ready-to-use test data and scenarios.  For details [contact us](https://digital.nhs.uk/developer/help-and-support).

    For more details see [integration testing with our RESTful APIs](https://digital.nhs.uk/developer/guides-and-documentation/testing#integration-testing-with-our-restful-apis).

    ## Onboarding

    You need to get your software approved by us before it can go live with this API. We call this onboarding. The onboarding process can sometimes be quite long, so it’s worth planning well ahead.

    As part of this process, you need to demonstrate that you can manage risks and that your software conforms technically with the requirements for this API.

    Information on this page might impact the design of your software. For details, see [Onboarding support information](https://digital.nhs.uk/developer/api-catalogue/national-record-locator-consumer-fhir/onboarding-support-information).

    To understand how our online digital onboarding process works, see [digital onboarding](https://digital.nhs.uk/developer/guides-and-documentation/digital-onboarding#using-the-digital-onboarding-portal).

    <div class="nhsd-m-emphasis-box nhsd-m-emphasis-box--emphasis nhsd-!t-margin-bottom-6" aria-label="Highlighted Information">
        <div class="nhsd-a-box nhsd-a-box--border-blue">
            <div class="nhsd-m-emphasis-box__image-box">
                <figure class="nhsd-a-image">
                    <picture class="nhsd-a-image__picture">
                        <img src="http://digital.nhs.uk/binaries/content/gallery/icons/play-circle.svg?colour=231f20" alt="" style="object-fit:fill">
                    </picture>
                </figure>
            </div>
            <div class="nhsd-m-emphasis-box__content-box">
                <div data-uipath="website.contentblock.emphasis.content" class="nhsd-t-word-break"><p class="nhsd-t-body">To get started, sign in or create a <a href="http://onboarding.prod.api.platform.nhs.uk/">developer account</a>, then select 'product onboarding'.</p></div>
            </div>
        </div>
    </div>

    ## Change log

    For details of how this API has changed over time, see the [change log](https://github.com/NHSDigital/NRLF/blob/main/CHANGELOG.md).
  version: 1.0.0
  license:
    name: MIT
  contact:
    name: NHS Digital API Management
    url: "https://digital.nhs.uk/developer/help-and-support"
    email: api.management@nhs.net
servers:
  - url: https://sandbox.api.service.nhs.uk/record-locator/consumer/FHIR/R4
    description: Sandbox environment.
  - url: https://int.api.service.nhs.uk/record-locator/consumer/FHIR/R4
    description: Integration test environment.
  - url: https://api.service.nhs.uk/record-locator/consumer/FHIR/R4
    description: Production environment.
paths:
  /DocumentReference:
    get:
      summary: Retrieve patient's document pointers (GET)
      operationId: searchDocumentReference
      parameters:
        - $ref: "#/components/parameters/subject"
        - $ref: "#/components/parameters/custodian"
        - $ref: "#/components/parameters/type"
        - $ref: "#/components/parameters/nextPageToken"
        - $ref: "#/components/parameters/odsCode"
        - $ref: "#/components/parameters/odsCodeExtension"
        - $ref: "#/components/parameters/requestId"
        - $ref: "#/components/parameters/correlationId"
      responses:
        "200":
          description: Successful response
          content:
            application/fhir+json;version=1:
              schema:
                $ref: "#/components/schemas/Bundle"
              example:
                resourceType: Bundle
                type: searchset
                total: 1
                entry:
                  - resource:
                      resourceType: DocumentReference
                      id: Y05868-1634567890
                      meta:
                        profile:
                          - http://fhir.nhs.net/StructureDefinition/nrls-documentreference-1-0
                      masterIdentifier:
                        system: urn:ietf:rfc:3986
                        value: urn:oid:1.3.6.1.4.1.21367.2005.3.7
                      identifier:
                        - system: urn:ietf:rfc:3986
                          value: urn:oid:1.3.6.1.4.1.21367.2005.3.7.1234
                      status: current
                      docStatus: preliminary
                      type:
                        coding:
                          - system: http://snomed.info/sct
                            code: "736253002"
                            display: Mental health crisis plan
                      category:
                        - coding:
                            - system: http://loinc.org
                              code: 34108-1
                              display: Outpatient Note
                      subject:
                        identifier:
                          system: https://fhir.nhs.uk/Id/nhs-number
                          value: "4409815415"
                      date: "2022-12-20T09:45:41+11:00"
                      author:
                        - identifier:
                            value: Practitioner/A985657ZA
                      authenticator:
                        identifier:
                          value: Organization/Y05868
                      custodian:
                        identifier:
                          system: https://fhir.nhs.uk/Id/ods-organization-code
                          value: Y05868
                      description: Physical
                      securityLabel:
                        - coding:
                            - system: http://terminology.hl7.org/CodeSystem/v3-Confidentiality
                              code: V
                              display: very restricted
                      content:
                        - attachment:
                            contentType: application/pdf
                            language: en-US
                            url: https://spine-proxy.national.ncrs.nhs.uk/p1.nhs.uk/EPAACS/MentalHealthCrisisPlan.pdf
                            hash: 2jmj7l5rSw0yVb/vlWAYkK/YBwk=
                            title: Physical
                            creation: "2022-12-20T09:45:41+11:00"
                          format:
                            system: urn:oid:1.3.6.1.4.1.19376.1.2.3
                            code: urn:ihe:pcc:handp:2008
                            display: History and Physical Specification
                      context:
                        encounter:
                          - identifier:
                              value: Encounter/4409815415
                        event:
                          - coding:
                              - system: http://snomed.info/sct
                                code: "305625009"
                                display: Seen by mental health counselor
                        period:
                          start: "2022-12-20T09:00:41+11:00"
                          end: "2022-12-20T09:45:41+11:00"
                        facilityType:
                          coding:
                            - system: http://snomed.info/sct
                              code: "390826005"
                              display: Mental health caregiver support
                        practiceSetting:
                          coding:
                            - system: http://snomed.info/sct
                              code: "390826005"
                              display: Mental health caregiver support
                        sourcePatientInfo:
                          identifier:
                            value: Patient/4409815415
                        related:
                          - identifier:
                              system: https://fhir.nhs.uk/Id/ods-organization-code
                              value: MENTAL HEALTH OUTREACH
          headers:
            X-Correlation-Id:
              $ref: "#/components/headers/CorrelationId"
            X-Request-Id:
              $ref: "#/components/headers/RequestId"
      description: |
        Retrieve the document pointers for a single patient.  Your request is constrained by the document pointer types
        agreed during onboarding.  The results can also be filtered to return documents by a given `type` and/or created
        by a given producer (`custodian`).

        This operation is also available as a http POST, which is the preferred method (see below).
  /DocumentReference/_search:
    post:
      summary: Retrieve patient's document pointers (POST)
      operationId: searchPostDocumentReference
      parameters:
        - $ref: "#/components/parameters/odsCode"
        - $ref: "#/components/parameters/requestId"
        - $ref: "#/components/parameters/correlationId"
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RequestParams"
      responses:
        "200":
          description: Search successful response
          content:
            application/fhir+json;version=1:
              schema:
                $ref: "#/components/schemas/Bundle"
              example:
                resourceType: Bundle
                type: searchset
                total: 1
                entry:
                  - resource:
                      resourceType: DocumentReference
                      id: Y05868-1234567895
                      meta:
                        profile:
                          - http://fhir.nhs.net/StructureDefinition/nrls-documentreference-1-0
                      masterIdentifier:
                        system: urn:ietf:rfc:3986
                        value: urn:oid:1.3.6.1.4.1.21367.2005.3.9
                      identifier:
                        - system: urn:ietf:rfc:3986
                          value: urn:oid:1.3.6.1.4.1.21367.2005.3.7.1239
                      status: current
                      docStatus: final
                      type:
                        coding:
                          - system: http://snomed.info/sct
                            code: "736253002"
                            display: Mental Health Crisis Plan
                      category:
                        - coding:
                            - system: http://loinc.org
                              code: 55112-7
                              display: Document summary
                      subject:
                        identifier:
                          system: https://fhir.nhs.uk/Id/nhs-number
                          value: "4409815415"
                      date: "2022-12-21T10:45:41+11:00"
                      author:
                        - identifier:
                            value: Practitioner/A985657ZA
                      authenticator:
                        identifier:
                          value: Organization/Y05868
                      custodian:
                        identifier:
                          system: https://fhir.nhs.uk/Id/ods-organization-code
                          value: Y05868
                      description: Physical
                      securityLabel:
                        - coding:
                            - system: http://terminology.hl7.org/CodeSystem/v3-Confidentiality
                              code: V
                              display: very restricted
                      content:
                        - attachment:
                            contentType: application/pdf
                            language: en-US
                            url: https://spine-proxy.national.ncrs.nhs.uk/p1.nhs.uk/EPAACS/EOLSummaryReport.pdf
                            size: 4000
                            hash: 2jmj7l5rSw0yVb/vlWAYkK/YBwk=
                            title: Physical
                            creation: "2021-12-21T10:45:41+11:00"
                          format:
                            system: urn:oid:1.3.6.1.4.1.19376.1.2.3
                            code: urn:ihe:pcc:cm:2008
                            display: Care Management
                      context:
                        encounter:
                          - identifier:
                              value: Encounter/4409815415
                        event:
                          - coding:
                              - system: http://snomed.info/sct
                                code: "861421000000109"
                                display: End of life care coordination summary
                        period:
                          start: "2022-12-21T09:00:41+11:00"
                          end: "2022-12-21T10:45:41+11:00"
                        facilityType:
                          coding:
                            - system: http://snomed.info/sct
                              code: "14866005"
                              display: Hospital outpatient mental health center
                        sourcePatientInfo:
                          identifier:
                            value: Patient/4409815415
                        related:
                          - identifier:
                              system: https://fhir.nhs.uk/Id/ods-organization-code
                              value: TRAFFORD GENERAL HOSPITAL
          headers:
            X-Correlation-Id:
              $ref: "#/components/headers/CorrelationId"
            X-Request-Id:
              $ref: "#/components/headers/RequestId"
      description: |
        Retrieve the document pointers for a single patient.  Your request is constrained by the document pointer types
        agreed during onboarding.  The results can also be filtered to return documents by a given `type` and/or created
        by a given `custodian`.

        This operation is also available as a http GET for convenience (see above), but POST is preferred for the
        following reasons.

        * query string parameters are visible on the network and in logs, and may have privacy implications for consumers.
        * GET operations can be cached by intermediary network infrastructure, such as CDNs, routers and proxies.
        * URLs have a maximum length of 2,048 characters which complex searches can exceed.  NRL does not currently
        exceed this limit, but may evolve in the future.
  /DocumentReference/{id}:
    get:
      summary: Get a single document pointer
      operationId: readDocumentReference
      parameters:
        - $ref: "#/components/parameters/id"
        - $ref: "#/components/parameters/odsCode"
        - $ref: "#/components/parameters/odsCodeExtension"
        - $ref: "#/components/parameters/requestId"
        - $ref: "#/components/parameters/correlationId"
      responses:
        "200":
          description: Search successful response
          content:
            application/fhir+json;version=1:
              schema:
                $ref: "#/components/schemas/DocumentReference"
              example:
                resourceType: DocumentReference
                id: Y05868-1234567892
                status: current
                docStatus: final
                type:
                  coding:
                    - system: http://snomed.info/sct
                      code: "887701000000100"
                      display: Emergency health care plan
                category:
                  - coding:
                      - system: http://loinc.org
                        code: 68552-9
                        display: Emergency medicine Emergency department Admission evaluation note
                subject:
                  identifier:
                    system: https://fhir.nhs.uk/Id/nhs-number
                    value: "4409815415"
                date: "2022-12-22T11:45:41+11:00"
                author:
                  - identifier:
                      value: Practitioner/A985657ZA
                authenticator:
                  identifier:
                    value: Organization/Y05868
                custodian:
                  identifier:
                    system: https://fhir.nhs.uk/Id/ods-organization-code
                    value: Y05868
                securityLabel:
                  - coding:
                      - system: http://terminology.hl7.org/CodeSystem/v3-Confidentiality
                        code: V
                        display: very restricted
                content:
                  - attachment:
                      contentType: application/pdf
                      language: en-US
                      url: https://spine-proxy.national.ncrs.nhs.uk/p1.nhs.uk/EPAACS/EmergencyHealthPlan.pdf
                      creation: "2022-12-22T09:45:41+11:00"
                    format:
                      system: urn:oid:1.3.6.1.4.1.19376.1.2.3
                      code: urn:ihe:pcc:handp:2008
                      display: History and Physical Specification
                context:
                  encounter:
                    - identifier:
                        value: Encounter/4409815415
                  event:
                    - coding:
                        - system: http://snomed.info/sct
                          code: "702779007"
                          display: Emergency health care plan agreed
                  period:
                    start: "2022-12-20T09:00:41+11:00"
                    end: "2022-12-20T09:45:41+11:00"
                  facilityType:
                    coding:
                      - system: http://snomed.info/sct
                        code: "453121000124107"
                        display: Emergency department healthcare professional
                  related:
                    - identifier:
                        system: https://fhir.nhs.uk/Id/ods-organization-code
                        value: EMERGENCY DEPT PRIMARY CARE STREAMING
          headers:
            X-Correlation-Id:
              $ref: "#/components/headers/CorrelationId"
            X-Request-Id:
              $ref: "#/components/headers/RequestId"
      description: |
        Read a single document pointer by specifying the `DocumentReference.id`.  Note that you will only be able to
        retrieve document pointers that have the `type` that was agreed during the [onboarding](#api-description__onboarding) process.
  /DocumentReference/_count:
    get:
      summary: Count document pointers
      operationId: countDocumentReference
      parameters:
        - $ref: "#/components/parameters/subject"
        - $ref: "#/components/parameters/odsCode"
        - $ref: "#/components/parameters/odsCodeExtension"
        - $ref: "#/components/parameters/requestId"
        - $ref: "#/components/parameters/correlationId"
      responses:
        "200":
          description: Count DocumentReference operation successful
          headers:
            X-Correlation-Id:
              $ref: "#/components/headers/CorrelationId"
            X-Request-Id:
              $ref: "#/components/headers/RequestId"
          content:
            application/fhir+json;version=1:
              schema:
                $ref: "#/components/schemas/Bundle"
components:
  requestBodies:
    DocumentReference:
      content:
        application/fhir+json;version=1:
          schema:
            $ref: "#/components/schemas/DocumentReference"
      required: true
  schemas:
    OperationOutcome:
      type: object
      properties:
        resourceType:
          type: string
          enum:
            - OperationOutcome
        id:
          type: string
          pattern: "[A-Za-z0-9\\-\\.]{1,64}"
          description: The logical id of the resource, as used in the URL for the resource. Once assigned, this value never changes.
        meta:
          $ref: "#/components/schemas/Meta"
          description: The metadata about the resource. This is content that is maintained by the infrastructure. Changes to the content might not always be associated with version changes to the resource.
        implicitRules:
          type: string
          pattern: \S*
          description: A reference to a set of rules that were followed when the resource was constructed, and which must be understood when processing the content. Often, this is a reference to an implementation guide that defines the special rules along with other profiles etc.
        language:
          type: string
          pattern: "[^\\s]+(\\s[^\\s]+)*"
          description: The base language in which the resource is written.
        text:
          $ref: "#/components/schemas/Narrative"
          description: A human&ndash;readable narrative that contains a summary of the resource and can be used to represent the content of the resource to a human. The narrative need not encode all the structured data, but is required to contain sufficient detail to make it "clinically safe" for a human to just read the narrative. Resource definitions may define what content should be represented in the narrative to ensure clinical safety.
        issue:
          type: array
          items:
            $ref: "#/components/schemas/OperationOutcomeIssue"
            description: An error, warning, or information message that results from a system action.
          minItems: 1
      required:
        - resourceType
        - issue
    OperationOutcomeIssue:
      type: object
      properties:
        id:
          type: string
          pattern: "[A-Za-z0-9\\-\\.]{1,64}"
          description: Unique id for the element within a resource (for internal references). This may be any string value that does not contain spaces.
        severity:
          type: string
          pattern: "[^\\s]+(\\s[^\\s]+)*"
          description: Indicates whether the issue indicates a variation from successful processing.
        code:
          type: string
          pattern: "[^\\s]+(\\s[^\\s]+)*"
          description: Describes the type of the issue. The system that creates an OperationOutcome SHALL choose the most applicable code from the IssueType value set, and may additional provide its own code for the error in the details element.
        details:
          $ref: "#/components/schemas/CodeableConcept"
          description: Additional details about the error. This may be a text description of the error or a system code that identifies the error.
        diagnostics:
          type: string
          pattern: "[ \\r\\n\\t\\S]+"
          description: Additional diagnostic information about the issue.
        location:
          type: array
          items:
            type: string
            pattern: "[ \\r\\n\\t\\S]+"
            description: "This element is deprecated because it is XML specific. It is replaced by issue.expression, which is format independent, and simpler to parse. \n\nFor resource issues, this will be a simple XPath limited to element names, repetition indicators and the default child accessor that identifies one of the elements in the resource that caused this issue to be raised.  For HTTP errors, will be \"http.\" + the parameter name."
        expression:
          type: array
          items:
            type: string
            pattern: "[ \\r\\n\\t\\S]+"
            description: A [simple subset of FHIRPath](fhirpath.html#simple) limited to element names, repetition indicators and the default child accessor that identifies one of the elements in the resource that caused this issue to be raised.
      required:
        - severity
        - code
    DocumentReference:
      type: object
      properties:
        resourceType:
          type: string
          enum:
            - DocumentReference
        id:
          type: string
          pattern: "[A-Za-z0-9\\-\\.]{1,64}"
          description: The logical id of the resource, as used in the URL for the resource. Once assigned, this value never changes.
        meta:
          $ref: "#/components/schemas/Meta"
          description: The metadata about the resource. This is content that is maintained by the infrastructure. Changes to the content might not always be associated with version changes to the resource.
        implicitRules:
          type: string
          pattern: \S*
          description: A reference to a set of rules that were followed when the resource was constructed, and which must be understood when processing the content. Often, this is a reference to an implementation guide that defines the special rules along with other profiles etc.
        language:
          type: string
          pattern: "[^\\s]+(\\s[^\\s]+)*"
          description: The base language in which the resource is written.
        text:
          $ref: "#/components/schemas/Narrative"
          description: A human&ndash;readable narrative that contains a summary of the resource and can be used to represent the content of the resource to a human. The narrative need not encode all the structured data, but is required to contain sufficient detail to make it "clinically safe" for a human to just read the narrative. Resource definitions may define what content should be represented in the narrative to ensure clinical safety.
        masterIdentifier:
          $ref: "#/components/schemas/Identifier"
          description: Document identifier as assigned by the source of the document. This identifier is specific to this version of the document. This unique identifier may be used elsewhere to identify this version of the document.
        identifier:
          type: array
          items:
            $ref: "#/components/schemas/Identifier"
            description: Other identifiers associated with the document, including version independent identifiers.
        status:
          type: string
          pattern: "[^\\s]+(\\s[^\\s]+)*"
          description: The status of this document reference.
        docStatus:
          type: string
          pattern: "[^\\s]+(\\s[^\\s]+)*"
          description: The status of the underlying document.
        type:
          $ref: "#/components/schemas/CodeableConcept"
          description: Specifies the particular kind of document referenced  (e.g. History and Physical, Discharge Summary, Progress Note). This usually equates to the purpose of making the document referenced.
        category:
          type: array
          items:
            $ref: "#/components/schemas/CodeableConcept"
            description: A categorization for the type of document referenced &ndash; helps for indexing and searching. This may be implied by or derived from the code specified in the DocumentReference.type.
        subject:
          $ref: "#/components/schemas/Reference"
          description: Who or what the document is about. The document can be about a person, (patient or healthcare practitioner), a device (e.g. a machine) or even a group of subjects (such as a document about a herd of farm animals, or a set of patients that share a common exposure).
        date:
          type: string
          pattern: ([0-9]([0-9]([0-9][1-9]|[1-9]0)|[1-9]00)|[1-9]000)-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])T([01][0-9]|2[0-3]):[0-5][0-9]:([0-5][0-9]|60)(\.[0-9]+)?(Z|(\+|-)((0[0-9]|1[0-3]):[0-5][0-9]|14:00))
          description: When the document reference was created.
        author:
          type: array
          items:
            $ref: "#/components/schemas/Reference"
            description: Identifies who is responsible for adding the information to the document.
        authenticator:
          $ref: "#/components/schemas/Reference"
          description: Which person or organization authenticates that this document is valid.
        custodian:
          $ref: "#/components/schemas/Reference"
          description: Identifies the organization or group who is responsible for ongoing maintenance of and access to the document.
        relatesTo:
          type: array
          items:
            $ref: "#/components/schemas/DocumentReferenceRelatesTo"
            description: Relationships that this document has with other document references that already exist.
        description:
          type: string
          pattern: "[ \\r\\n\\t\\S]+"
          description: Human&ndash;readable description of the source document.
        securityLabel:
          type: array
          items:
            $ref: "#/components/schemas/CodeableConcept"
            description: A set of Security&ndash;Tag codes specifying the level of privacy/security of the Document. Note that DocumentReference.meta.security contains the security labels of the "reference" to the document, while DocumentReference.securityLabel contains a snapshot of the security labels on the document the reference refers to.
        content:
          type: array
          items:
            $ref: "#/components/schemas/DocumentReferenceContent"
            description: The document and format referenced. There may be multiple content element repetitions, each with a different format.
          minItems: 1
        context:
          $ref: "#/components/schemas/DocumentReferenceContext"
          description: The clinical context in which the document was prepared.
      required:
        - resourceType
        - status
        - content
    Bundle:
      type: object
      properties:
        resourceType:
          type: string
          enum:
            - Bundle
        id:
          type: string
          pattern: "[A-Za-z0-9\\-\\.]{1,64}"
          description: The logical id of the resource, as used in the URL for the resource. Once assigned, this value never changes.
        meta:
          $ref: "#/components/schemas/Meta"
          description: The metadata about the resource. This is content that is maintained by the infrastructure. Changes to the content might not always be associated with version changes to the resource.
        implicitRules:
          type: string
          pattern: \S*
          description: A reference to a set of rules that were followed when the resource was constructed, and which must be understood when processing the content. Often, this is a reference to an implementation guide that defines the special rules along with other profiles etc.
        language:
          type: string
          pattern: "[^\\s]+(\\s[^\\s]+)*"
          description: The base language in which the resource is written.
        identifier:
          $ref: "#/components/schemas/Identifier"
          description: A persistent identifier for the bundle that won't change as a bundle is copied from server to server.
        type:
          type: string
          pattern: "[^\\s]+(\\s[^\\s]+)*"
          description: Indicates the purpose of this bundle &ndash; how it is intended to be used.
        timestamp:
          type: string
          pattern: ([0-9]([0-9]([0-9][1-9]|[1-9]0)|[1-9]00)|[1-9]000)-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])T([01][0-9]|2[0-3]):[0-5][0-9]:([0-5][0-9]|60)(\.[0-9]+)?(Z|(\+|-)((0[0-9]|1[0-3]):[0-5][0-9]|14:00))
          description: The date/time that the bundle was assembled &ndash; i.e. when the resources were placed in the bundle.
        total:
          type: integer
          format: int32
          description: If a set of search matches, this is the total number of entries of type 'match' across all pages in the search.  It does not include search.mode = 'include' or 'outcome' entries and it does not provide a count of the number of entries in the Bundle.
        link:
          type: array
          items:
            $ref: "#/components/schemas/BundleLink"
            description: A series of links that provide context to this bundle.
        entry:
          type: array
          items:
            $ref: "#/components/schemas/BundleEntry"
            description: An entry in a bundle resource &ndash; will either contain a resource or information about a resource (transactions and history only).
        signature:
          $ref: "#/components/schemas/Signature"
          description: Digital Signature &ndash; base64 encoded. XML&ndash;DSig or a JWT.
      required:
        - resourceType
        - type
    BundleEntry:
      type: object
      properties:
        id:
          type: string
          pattern: "[A-Za-z0-9\\-\\.]{1,64}"
          description: Unique id for the element within a resource (for internal references). This may be any string value that does not contain spaces.
        link:
          type: array
          items:
            $ref: "#/components/schemas/BundleLink"
            description: A series of links that provide context to this entry.
        fullUrl:
          type: string
          pattern: \S*
          description: "The Absolute URL for the resource.  The fullUrl SHALL NOT disagree with the id in the resource &ndash; i.e. if the fullUrl is not a urn:uuid, the URL shall be version&ndash;independent URL consistent with the Resource.id. The fullUrl is a version independent reference to the resource. The fullUrl element SHALL have a value except that: \n* fullUrl can be empty on a POST (although it does not need to when specifying a temporary id for reference in the bundle)\n* Results from operations might involve resources that are not identified."
        resource:
          $ref: "#/components/schemas/DocumentReference"
          description: The Resource for the entry. The purpose/meaning of the resource is determined by the Bundle.type.
        search:
          $ref: "#/components/schemas/BundleEntrySearch"
          description: Information about the search process that lead to the creation of this entry.
        request:
          $ref: "#/components/schemas/BundleEntryRequest"
          description: Additional information about how this entry should be processed as part of a transaction or batch.  For history, it shows how the entry was processed to create the version contained in the entry.
        response:
          $ref: "#/components/schemas/BundleEntryResponse"
          description: Indicates the results of processing the corresponding 'request' entry in the batch or transaction being responded to or what the results of an operation where when returning history.
    BundleEntryResponse:
      type: object
      properties:
        id:
          type: string
          pattern: "[A-Za-z0-9\\-\\.]{1,64}"
          description: Unique id for the element within a resource (for internal references). This may be any string value that does not contain spaces.
        status:
          type: string
          pattern: "[ \\r\\n\\t\\S]+"
          description: The status code returned by processing this entry. The status SHALL start with a 3 digit HTTP code (e.g. 404) and may contain the standard HTTP description associated with the status code.
        location:
          type: string
          pattern: \S*
          description: The location header created by processing this operation, populated if the operation returns a location.
        etag:
          type: string
          pattern: "[ \\r\\n\\t\\S]+"
          description: The Etag for the resource, if the operation for the entry produced a versioned resource (see [Resource Metadata and Versioning](http.html#versioning) and [Managing Resource Contention](http.html#concurrency)).
        lastModified:
          type: string
          pattern: ([0-9]([0-9]([0-9][1-9]|[1-9]0)|[1-9]00)|[1-9]000)-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])T([01][0-9]|2[0-3]):[0-5][0-9]:([0-5][0-9]|60)(\.[0-9]+)?(Z|(\+|-)((0[0-9]|1[0-3]):[0-5][0-9]|14:00))
          description: The date/time that the resource was modified on the server.
        outcome:
          $ref: "#/components/schemas/DocumentReference"
          description: An OperationOutcome containing hints and warnings produced as part of processing this entry in a batch or transaction.
      required:
        - status
    BundleEntryRequest:
      type: object
      properties:
        id:
          type: string
          pattern: "[A-Za-z0-9\\-\\.]{1,64}"
          description: Unique id for the element within a resource (for internal references). This may be any string value that does not contain spaces.
        method:
          type: string
          pattern: "[^\\s]+(\\s[^\\s]+)*"
          description: In a transaction or batch, this is the HTTP action to be executed for this entry. In a history bundle, this indicates the HTTP action that occurred.
        url:
          type: string
          pattern: \S*
          description: The URL for this entry, relative to the root (the address to which the request is posted).
        ifNoneMatch:
          type: string
          pattern: "[ \\r\\n\\t\\S]+"
          description: If the ETag values match, return a 304 Not Modified status. See the API documentation for ["Conditional Read"](http.html#cread).
        ifModifiedSince:
          type: string
          pattern: ([0-9]([0-9]([0-9][1-9]|[1-9]0)|[1-9]00)|[1-9]000)-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])T([01][0-9]|2[0-3]):[0-5][0-9]:([0-5][0-9]|60)(\.[0-9]+)?(Z|(\+|-)((0[0-9]|1[0-3]):[0-5][0-9]|14:00))
          description: Only perform the operation if the last updated date matches. See the API documentation for ["Conditional Read"](http.html#cread).
        ifMatch:
          type: string
          pattern: "[ \\r\\n\\t\\S]+"
          description: Only perform the operation if the Etag value matches. For more information, see the API section ["Managing Resource Contention"](http.html#concurrency).
        ifNoneExist:
          type: string
          pattern: "[ \\r\\n\\t\\S]+"
          description: Instruct the server not to perform the create if a specified resource already exists. For further information, see the API documentation for ["Conditional Create"](http.html#ccreate). This is just the query portion of the URL &ndash; what follows the "?" (not including the "?").
      required:
        - method
        - url
    BundleEntrySearch:
      type: object
      properties:
        id:
          type: string
          pattern: "[A-Za-z0-9\\-\\.]{1,64}"
          description: Unique id for the element within a resource (for internal references). This may be any string value that does not contain spaces.
        mode:
          type: string
          pattern: "[^\\s]+(\\s[^\\s]+)*"
          description: Why this entry is in the result set &ndash; whether it's included as a match or because of an _include requirement, or to convey information or warning information about the search process.
        score:
          type: number
          description: When searching, the server's search ranking score for the entry.
    BundleLink:
      type: object
      properties:
        id:
          type: string
          pattern: "[A-Za-z0-9\\-\\.]{1,64}"
          description: Unique id for the element within a resource (for internal references). This may be any string value that does not contain spaces.
        relation:
          type: string
          pattern: "[ \\r\\n\\t\\S]+"
          description: A name which details the functional use for this link &ndash; see [http://www.iana.org/assignments/link&ndash;relations/link&ndash;relations.xhtml#link&ndash;relations&ndash;1](http://www.iana.org/assignments/link&ndash;relations/link&ndash;relations.xhtml#link&ndash;relations&ndash;1).
        url:
          type: string
          pattern: \S*
          description: The reference details for the link.
      required:
        - relation
        - url
    DocumentReferenceContext:
      type: object
      properties:
        id:
          type: string
          pattern: "[A-Za-z0-9\\-\\.]{1,64}"
          description: Unique id for the element within a resource (for internal references). This may be any string value that does not contain spaces.
        encounter:
          type: array
          items:
            $ref: "#/components/schemas/Reference"
            description: Describes the clinical encounter or type of care that the document content is associated with.
        event:
          type: array
          items:
            $ref: "#/components/schemas/CodeableConcept"
            description: This list of codes represents the main clinical acts, such as a colonoscopy or an appendectomy, being documented. In some cases, the event is inherent in the type Code, such as a "History and Physical Report" in which the procedure being documented is necessarily a "History and Physical" act.
        period:
          $ref: "#/components/schemas/Period"
          description: The time period over which the service that is described by the document was provided.
        facilityType:
          $ref: "#/components/schemas/CodeableConcept"
          description: The kind of facility where the patient was seen.
        practiceSetting:
          $ref: "#/components/schemas/CodeableConcept"
          description: This property may convey specifics about the practice setting where the content was created, often reflecting the clinical specialty.
        sourcePatientInfo:
          $ref: "#/components/schemas/Reference"
          description: The Patient Information as known when the document was published. May be a reference to a version specific, or contained.
        related:
          type: array
          items:
            $ref: "#/components/schemas/Reference"
            description: Related identifiers or resources associated with the DocumentReference.
    DocumentReferenceContent:
      type: object
      properties:
        id:
          type: string
          pattern: "[A-Za-z0-9\\-\\.]{1,64}"
          description: Unique id for the element within a resource (for internal references). This may be any string value that does not contain spaces.
        attachment:
          $ref: "#/components/schemas/Attachment"
          description: The document or URL of the document along with critical metadata to prove content has integrity.
        format:
          $ref: "#/components/schemas/Coding"
          description: An identifier of the document encoding, structure, and template that the document conforms to beyond the base format indicated in the mimeType.
      required:
        - attachment
    DocumentReferenceRelatesTo:
      type: object
      properties:
        id:
          type: string
          pattern: "[A-Za-z0-9\\-\\.]{1,64}"
          description: Unique id for the element within a resource (for internal references). This may be any string value that does not contain spaces.
        code:
          type: string
          pattern: "[^\\s]+(\\s[^\\s]+)*"
          description: The type of relationship that this document has with anther document.
        target:
          $ref: "#/components/schemas/Reference"
          description: The target document of this relationship.
      required:
        - code
        - target
    Attachment:
      type: object
      properties:
        id:
          type: string
          pattern: "[A-Za-z0-9\\-\\.]{1,64}"
          description: Unique id for the element within a resource (for internal references). This may be any string value that does not contain spaces.
        contentType:
          type: string
          pattern: "[^\\s]+(\\s[^\\s]+)*"
          description: Identifies the type of the data in the attachment and allows a method to be chosen to interpret or render the data. Includes mime type parameters such as charset where appropriate.
        language:
          type: string
          pattern: "[^\\s]+(\\s[^\\s]+)*"
          description: The human language of the content. The value can be any valid value according to BCP 47.
        data:
          type: string
          pattern: (\s*([0-9a-zA-Z\+/=]){4}\s*)+
          description: The actual data of the attachment &ndash; a sequence of bytes, base64 encoded.
        url:
          type: string
          pattern: \S*
          description: A location where the data can be accessed.
        size:
          type: integer
          format: int32
          description: The number of bytes of data that make up this attachment (before base64 encoding, if that is done).
        hash:
          type: string
          pattern: (\s*([0-9a-zA-Z\+/=]){4}\s*)+
          description: The calculated hash of the data using SHA&ndash;1. Represented using base64.
        title:
          type: string
          pattern: "[ \\r\\n\\t\\S]+"
          description: A label or set of text to display in place of the data.
        creation:
          type: string
          pattern: ([0-9]([0-9]([0-9][1-9]|[1-9]0)|[1-9]00)|[1-9]000)(-(0[1-9]|1[0-2])(-(0[1-9]|[1-2][0-9]|3[0-1])(T([01][0-9]|2[0-3]):[0-5][0-9]:([0-5][0-9]|60)(\.[0-9]+)?(Z|(\+|-)((0[0-9]|1[0-3]):[0-5][0-9]|14:00)))?)?)?
          description: The date that the attachment was first created.
    CodeableConcept:
      type: object
      properties:
        id:
          type: string
          pattern: "[A-Za-z0-9\\-\\.]{1,64}"
          description: Unique id for the element within a resource (for internal references). This may be any string value that does not contain spaces.
        coding:
          type: array
          items:
            $ref: "#/components/schemas/Coding"
            description: A reference to a code defined by a terminology system.
        text:
          type: string
          pattern: "[ \\r\\n\\t\\S]+"
          description: A human language representation of the concept as seen/selected/uttered by the user who entered the data and/or which represents the intended meaning of the user.
    Coding:
      type: object
      properties:
        id:
          type: string
          pattern: "[A-Za-z0-9\\-\\.]{1,64}"
          description: Unique id for the element within a resource (for internal references). This may be any string value that does not contain spaces.
        system:
          type: string
          pattern: \S*
          description: The identification of the code system that defines the meaning of the symbol in the code.
        version:
          type: string
          pattern: "[ \\r\\n\\t\\S]+"
          description: The version of the code system which was used when choosing this code. Note that a well&ndash;maintained code system does not need the version reported, because the meaning of codes is consistent across versions. However this cannot consistently be assured, and when the meaning is not guaranteed to be consistent, the version SHOULD be exchanged.
        code:
          type: string
          pattern: "[^\\s]+(\\s[^\\s]+)*"
          description: A symbol in syntax defined by the system. The symbol may be a predefined code or an expression in a syntax defined by the coding system (e.g. post&ndash;coordination).
        display:
          type: string
          pattern: "[ \\r\\n\\t\\S]+"
          description: A representation of the meaning of the code in the system, following the rules of the system.
        userSelected:
          type: boolean
          description: Indicates that this coding was chosen by a user directly &ndash; e.g. off a pick list of available items (codes or displays).
    Identifier:
      type: object
      properties:
        id:
          type: string
          pattern: "[A-Za-z0-9\\-\\.]{1,64}"
          description: Unique id for the element within a resource (for internal references). This may be any string value that does not contain spaces.
        use:
          type: string
          pattern: "[^\\s]+(\\s[^\\s]+)*"
          description: The purpose of this identifier.
        type:
          $ref: "#/components/schemas/CodeableConcept"
          description: A coded type for the identifier that can be used to determine which identifier to use for a specific purpose.
        system:
          type: string
          pattern: \S*
          description: Establishes the namespace for the value &ndash; that is, a URL that describes a set values that are unique.
        value:
          type: string
          pattern: "[ \\r\\n\\t\\S]+"
          description: The portion of the identifier typically relevant to the user and which is unique within the context of the system.
        period:
          $ref: "#/components/schemas/Period"
          description: Time period during which identifier is/was valid for use.
        assigner:
          $ref: "#/components/schemas/Reference"
          description: Organization that issued/manages the identifier.
    Period:
      type: object
      properties:
        id:
          type: string
          pattern: "[A-Za-z0-9\\-\\.]{1,64}"
          description: Unique id for the element within a resource (for internal references). This may be any string value that does not contain spaces.
        start:
          type: string
          pattern: ([0-9]([0-9]([0-9][1-9]|[1-9]0)|[1-9]00)|[1-9]000)(-(0[1-9]|1[0-2])(-(0[1-9]|[1-2][0-9]|3[0-1])(T([01][0-9]|2[0-3]):[0-5][0-9]:([0-5][0-9]|60)(\.[0-9]+)?(Z|(\+|-)((0[0-9]|1[0-3]):[0-5][0-9]|14:00)))?)?)?
          description: The start of the period. The boundary is inclusive.
        end:
          type: string
          pattern: ([0-9]([0-9]([0-9][1-9]|[1-9]0)|[1-9]00)|[1-9]000)(-(0[1-9]|1[0-2])(-(0[1-9]|[1-2][0-9]|3[0-1])(T([01][0-9]|2[0-3]):[0-5][0-9]:([0-5][0-9]|60)(\.[0-9]+)?(Z|(\+|-)((0[0-9]|1[0-3]):[0-5][0-9]|14:00)))?)?)?
          description: The end of the period. If the end of the period is missing, it means no end was known or planned at the time the instance was created. The start may be in the past, and the end date in the future, which means that period is expected/planned to end at that time.
    Quantity:
      type: object
      properties:
        id:
          type: string
          pattern: "[A-Za-z0-9\\-\\.]{1,64}"
          description: Unique id for the element within a resource (for internal references). This may be any string value that does not contain spaces.
        value:
          type: number
          description: The value of the measured amount. The value includes an implicit precision in the presentation of the value.
        comparator:
          type: string
          pattern: "[^\\s]+(\\s[^\\s]+)*"
          description: How the value should be understood and represented &ndash; whether the actual value is greater or less than the stated value due to measurement issues; e.g. if the comparator is "<" , then the real value is < stated value.
        unit:
          type: string
          pattern: "[ \\r\\n\\t\\S]+"
          description: A human&ndash;readable form of the unit.
        system:
          type: string
          pattern: \S*
          description: The identification of the system that provides the coded form of the unit.
        code:
          type: string
          pattern: "[^\\s]+(\\s[^\\s]+)*"
          description: A computer processable form of the unit in some unit representation system.
    Reference:
      type: object
      properties:
        id:
          type: string
          pattern: "[A-Za-z0-9\\-\\.]{1,64}"
          description: Unique id for the element within a resource (for internal references). This may be any string value that does not contain spaces.
        reference:
          type: string
          pattern: "[ \\r\\n\\t\\S]+"
          description: A reference to a location at which the other resource is found. The reference may be a relative reference, in which case it is relative to the service base URL, or an absolute URL that resolves to the location where the resource is found. The reference may be version specific or not. If the reference is not to a FHIR RESTful server, then it should be assumed to be version specific. Internal fragment references (start with '#') refer to contained resources.
        type:
          type: string
          pattern: \S*
          description: |-
            The expected type of the target of the reference. If both Reference.type and Reference.reference are populated and Reference.reference is a FHIR URL, both SHALL be consistent.
            The type is the Canonical URL of Resource Definition that is the type this reference refers to. References are URLs that are relative to http://hl7.org/fhir/StructureDefinition/ e.g. "Patient" is a reference to http://hl7.org/fhir/StructureDefinition/Patient. Absolute URLs are only allowed for logical models (and can only be used in references in logical models, not resources).
        identifier:
          $ref: "#/components/schemas/Identifier"
          description: An identifier for the target resource. This is used when there is no way to reference the other resource directly, either because the entity it represents is not available through a FHIR server, or because there is no way for the author of the resource to convert a known identifier to an actual location. There is no requirement that a Reference.identifier point to something that is actually exposed as a FHIR instance, but it SHALL point to a business concept that would be expected to be exposed as a FHIR instance, and that instance would need to be of a FHIR resource type allowed by the reference.
        display:
          type: string
          pattern: "[ \\r\\n\\t\\S]+"
          description: Plain text narrative that identifies the resource in addition to the resource reference.
    Signature:
      type: object
      properties:
        id:
          type: string
          pattern: "[A-Za-z0-9\\-\\.]{1,64}"
          description: Unique id for the element within a resource (for internal references). This may be any string value that does not contain spaces.
        type:
          type: array
          items:
            $ref: "#/components/schemas/Coding"
            description: An indication of the reason that the entity signed this document. This may be explicitly included as part of the signature information and can be used when determining accountability for various actions concerning the document.
          minItems: 1
        when:
          type: string
          pattern: ([0-9]([0-9]([0-9][1-9]|[1-9]0)|[1-9]00)|[1-9]000)-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])T([01][0-9]|2[0-3]):[0-5][0-9]:([0-5][0-9]|60)(\.[0-9]+)?(Z|(\+|-)((0[0-9]|1[0-3]):[0-5][0-9]|14:00))
          description: When the digital signature was signed.
        who:
          $ref: "#/components/schemas/Reference"
          description: A reference to an application&ndash;usable description of the identity that signed  (e.g. the signature used their private key).
        onBehalfOf:
          $ref: "#/components/schemas/Reference"
          description: A reference to an application&ndash;usable description of the identity that is represented by the signature.
        targetFormat:
          type: string
          pattern: "[^\\s]+(\\s[^\\s]+)*"
          description: A mime type that indicates the technical format of the target resources signed by the signature.
        sigFormat:
          type: string
          pattern: "[^\\s]+(\\s[^\\s]+)*"
          description: A mime type that indicates the technical format of the signature. Important mime types are application/signature+xml for X ML DigSig, application/jose for JWS, and image/* for a graphical image of a signature, etc.
        data:
          type: string
          pattern: (\s*([0-9a-zA-Z\+/=]){4}\s*)+
          description: The base64 encoding of the Signature content. When signature is not recorded electronically this element would be empty.
      required:
        - type
        - when
        - who
    Meta:
      type: object
      properties:
        id:
          type: string
          pattern: "[A-Za-z0-9\\-\\.]{1,64}"
          description: Unique id for the element within a resource (for internal references). This may be any string value that does not contain spaces.
        versionId:
          type: string
          pattern: "[A-Za-z0-9\\-\\.]{1,64}"
          description: The version specific identifier, as it appears in the version portion of the URL. This value changes when the resource is created, updated, or deleted.
        lastUpdated:
          type: string
          pattern: ([0-9]([0-9]([0-9][1-9]|[1-9]0)|[1-9]00)|[1-9]000)-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])T([01][0-9]|2[0-3]):[0-5][0-9]:([0-5][0-9]|60)(\.[0-9]+)?(Z|(\+|-)((0[0-9]|1[0-3]):[0-5][0-9]|14:00))
          description: When the resource last changed &ndash; e.g. when the version changed.
        source:
          type: string
          pattern: \S*
          description: A uri that identifies the source system of the resource. This provides a minimal amount of [Provenance](provenance.html#) information that can be used to track or differentiate the source of information in the resource. The source may identify another FHIR server, document, message, database, etc.
        profile:
          type: array
          items:
            type: string
            pattern: \S*
            description: A list of profiles (references to [StructureDefinition](structuredefinition.html#) resources) that this resource claims to conform to. The URL is a reference to [StructureDefinition.url](structuredefinition&ndash;definitions.html#StructureDefinition.url).
        security:
          type: array
          items:
            $ref: "#/components/schemas/Coding"
            description: Security labels applied to this resource. These tags connect specific resources to the overall security policy and infrastructure.
        tag:
          type: array
          items:
            $ref: "#/components/schemas/Coding"
            description: Tags applied to this resource. Tags are intended to be used to identify and relate resources to process and workflow, and applications are not required to consider the tags when interpreting the meaning of a resource.
    Narrative:
      type: object
      properties:
        id:
          type: string
          pattern: "[A-Za-z0-9\\-\\.]{1,64}"
          description: Unique id for the element within a resource (for internal references). This may be any string value that does not contain spaces.
        status:
          type: string
          pattern: "[^\\s]+(\\s[^\\s]+)*"
          description: The status of the narrative &ndash; whether it's entirely generated (from just the defined data or the extensions too), or whether a human authored it and it may contain additional data.
        div:
          type: string
          description: The actual narrative content, a stripped down version of XHTML.
      required:
        - status
        - div
    DocumentId:
      type: string
      pattern: '[A-Za-z0-9\-\.]{1,64}' # https://build.fhir.org/datatypes.html#id
    RequestPathParams:
      type: object
      properties:
        id:
          $ref: "#/components/schemas/DocumentId"
      required:
        - id
    RequestHeader:
      type: object
      properties:
        odsCode:
          $ref: "#/components/schemas/RequestHeaderOdsCode"
      required:
        - odsCode
    RequestParams:
      type: object
      properties:
        subject:identifier:
          $ref: "#/components/schemas/RequestQuerySubject"
        custodian:identifier:
          $ref: "#/components/schemas/RequestQueryCustodian"
        type:
          $ref: "#/components/schemas/RequestQueryType"
        next-page-token:
          $ref: "#/components/schemas/NextPageToken"
      required:
        - subject:identifier
    CountRequestParams:
      type: object
      properties:
        subject:identifier:
          $ref: "#/components/schemas/RequestQuerySubject"
      required:
        - subject:identifier
    RequestQuerySubject:
      type: string
      pattern: ^https\:\/\/fhir\.nhs\.uk\/Id\/nhs-number\|(\d+)$
      example: "https://fhir.nhs.uk/Id/nhs-number|4409815415"
    RequestQueryCustodian:
      type: string
      pattern: ^https\:\/\/fhir\.nhs\.uk\/Id\/ods-organization-code\|(\w+)$
      example: "https://fhir.nhs.uk/Id/ods-organization-code|Y05868"
    RequestQueryType:
      type: string
      example: "http://snomed.info/sct|736253002"
    NextPageToken:
      type: string
    RequestHeaderOdsCode:
      type: string
    RequestHeaderOrganisationExtensionCode:
      type: string
    RequestHeaderRequestId:
      type: string
      pattern: "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$"
      example: 60E0B220-8136-4CA5-AE46-1D97EF59D068
    RequestHeaderCorrelationId:
      type: string
      example: 11C46F5F-CDEF-4865-94B2-0EE0EDCC26DA
  securitySchemes: {}
  parameters:
    id:
      name: id
      in: path
      required: true
      description: logical identifier
      schema:
        $ref: "#/components/schemas/DocumentId"
      examples:
        valid:
          summary: Valid
          value: Y05868-1234567892
        invalid:
          summary: Unknown
          value: Y05861-1234567800
    subject:
      name: subject:identifier
      in: query
      schema:
        $ref: "#/components/schemas/RequestQuerySubject"
      required: true
      examples:
        none:
          summary: None
          value: ""
        valid_1:
          summary: "Valid #1"
          value: https://fhir.nhs.uk/Id/nhs-number|4409815415
        valid_2:
          summary: "Valid #2"
          value: https://fhir.nhs.uk/Id/nhs-number|3495456481
        invalid:
          summary: Unknown
          value: https://fhir.nhs.uk/Id/nhs-number|3495456001
    custodian:
      name: custodian:identifier
      in: query
      schema:
        $ref: "#/components/schemas/RequestQueryCustodian"
      examples:
        none:
          summary: None
          value: ""
        valid:
          summary: Valid
          value: https://fhir.nhs.uk/Id/ods-organization-code|Y05868
        invalid:
          summary: Unknown
          value: https://fhir.nhs.uk/Id/another-code|XYZ
    type:
      name: type
      in: query
      schema:
        $ref: "#/components/schemas/RequestQueryType"
      examples:
        none:
          summary: None
          value: ""
        SNOMED_CODES_MENTAL_HEALTH_CRISIS_PLAN:
          summary: Mental Health Crisis Plan
          value: http://snomed.info/sct|736253002
        SNOMED_CODES_EMERGENCY_HEALTH_CARE_PLAN:
          summary: Emergency Healthcare Plan
          value: http://snomed.info/sct|887701000000100
        SNOMED_CODES_END_OF_LIFE_CARE_COORDINATION_SUMMARY:
          summary: End of Life Care Coordination Summary
          value: http://snomed.info/sct|861421000000109
        SNOMED_CODES_NATIONAL_EARLY_WARNING_SCORE_2:
          summary: National Early Warning Code 2
          value: http://snomed.info/sct|1363501000000100
        invalid:
          summary: Unknown
          value: http://snomed.info/sct|410970009
    nextPageToken:
      name: next-page-token
      description: |
        A token that can be sent as either a query parameter or in the post body parameter to retrieve the next set of 20 records.

        This token is returned in the meta.tag field.
      in: query
      schema:
        $ref: "#/components/schemas/NextPageToken"
    odsCode:
      name: NHSD-End-User-Organisation-ODS
      description: ODS Code for Organisation
      in: header
      schema:
        $ref: "#/components/schemas/RequestHeaderOdsCode"
      required: true
      examples:
        valid:
          summary: Valid
          value: Y05868
        invalid:
          summary: Unknown
          value: XYZ
    odsCodeExtension:
      name: NHSD-End-User-Organisation
      description: Organisation extension code
      in: header
      schema:
        $ref: "#/components/schemas/RequestHeaderOrganisationExtensionCode"
    requestId:
      name: X-Request-ID
      description: |
        A globally unique identifier (GUID) for the request, which can be used to trace the request if you contact our helpdesk.

        Must be a universally unique identifier (UUID) (ideally version 4).

        Mirrored back in a response header.
      in: header
      required: false
      schema:
        $ref: "#/components/schemas/RequestHeaderRequestId"
    correlationId:
      name: X-Correlation-ID
      description: |
        An optional ID which you can use to track transactions across multiple systems, and we use to de-duplicate repeated requests and to trace the request if you contact our helpdesk.

        If you re-send a failed request please re-send this ID in the header.

        It can take any value, but we recommend avoiding `.` characters.

        Mirrored back in a response header.
      in: header
      required: false
      schema:
        $ref: "#/components/schemas/RequestHeaderCorrelationId"
  responses:
    Success:
      description: Success Response
      content:
        application/fhir+json;version=1:
          schema:
            $ref: "#/components/schemas/OperationOutcome"
    Error:
      description: Error Response
      content:
        application/fhir+json;version=1:
          schema:
            $ref: "#/components/schemas/OperationOutcome"
  headers:
    CorrelationId:
      schema:
        type: string
        example: 11C46F5F-CDEF-4865-94B2-0EE0EDCC26DA
        description: |
          The X-Correlation-ID from the request header, if supplied, mirrored back.
    RequestId:
      schema:
        type: string
        pattern: "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$"
        example: 60E0B220-8136-4CA5-AE46-1D97EF59D068
        description: |
          The X-Request-ID from the request header, if supplied, mirrored back.
